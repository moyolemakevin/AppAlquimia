<ion-header>
  <ion-toolbar color="primary">
    <ion-title>Panel de administracion</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content fullscreen class="app-shell admin-page">
  <section class="surface-section admin-overview" *ngIf="dashboard() as data">
    <div class="section-header">
      <h3>Indicadores clave</h3>
      <p>Monitorea actividad en tiempo real y gestiona contenido de la plataforma.</p>
    </div>
    <div class="metrics-grid">
      <div class="metric-card">
        <span class="metric-title">Aceites</span>
        <span class="metric-value">{{ data.counts.aceites }}</span>
      </div>
      <div class="metric-card">
        <span class="metric-title">Usuarios</span>
        <span class="metric-value">{{ data.counts.usuarios }}</span>
      </div>
      <div class="metric-card">
        <span class="metric-title">Tips</span>
        <span class="metric-value">{{ data.counts.tips }}</span>
      </div>
      <div class="metric-card">
        <span class="metric-title">Favoritos</span>
        <span class="metric-value">{{ data.counts.favoritos }}</span>
      </div>
    </div>
  </section>

  <section class="surface-section admin-forms">
    <ion-accordion-group class="admin-accordion">
      <ion-accordion value="aceites">
        <ion-item slot="header" color="light" class="accordion-header">
          <ion-icon slot="start" name="construct-outline"></ion-icon>
          <ion-label>Gestionar aceites</ion-label>
        </ion-item>
        <div class="accordion-content" slot="content">
          <form [formGroup]="aceiteForm" (ngSubmit)="submitAceite()" class="admin-form">
            <ion-list lines="none">
              <ion-item>
                <ion-label position="stacked">Nombre</ion-label>
                <ion-input formControlName="nombre"></ion-input>
              </ion-item>
              <ion-item>
                <ion-label position="stacked">Imagen (URL)</ion-label>
                <ion-input formControlName="imagen_url" placeholder="https://..."></ion-input>
              </ion-item>
              <ion-item>
                <ion-label position="stacked">Descripcion</ion-label>
                <ion-input formControlName="descripcion"></ion-input>
              </ion-item>
              <ion-item>
                <ion-label position="stacked">Beneficios</ion-label>
                <ion-input formControlName="beneficios"></ion-input>
              </ion-item>
              <ion-item>
                <ion-label position="stacked">Usos</ion-label>
                <ion-input formControlName="usos"></ion-input>
              </ion-item>
              <ion-item>
                <ion-label position="stacked">Precauciones</ion-label>
                <ion-input formControlName="precauciones"></ion-input>
              </ion-item>
              <ion-item>
                <ion-label position="stacked">Emociones relacionadas</ion-label>
                <ion-input formControlName="emociones_relacionadas"></ion-input>
              </ion-item>
            </ion-list>
            <div class="form-actions">
              <ion-button type="submit">{{ aceiteForm.value.id ? 'Actualizar' : 'Crear' }}</ion-button>
              <ion-button fill="clear" type="button" (click)="resetAceiteForm()">Limpiar</ion-button>
            </div>
          </form>

          <ion-list class="admin-list">
            <ion-item *ngFor="let aceite of aceites()">
              <ion-label>
                <h3>{{ aceite.nombre }}</h3>
                <p>{{ aceite.beneficios }}</p>
              </ion-label>
              <ion-button fill="clear" size="small" (click)="editAceite(aceite)">Editar</ion-button>
              <ion-button fill="clear" size="small" color="danger" (click)="deleteAceite(aceite.id)">
                Eliminar
              </ion-button>
            </ion-item>
          </ion-list>
        </div>
      </ion-accordion>

      <ion-accordion value="tips">
        <ion-item slot="header" color="light" class="accordion-header">
          <ion-icon slot="start" name="analytics-outline"></ion-icon>
          <ion-label>Gestionar tips</ion-label>
        </ion-item>
        <div class="accordion-content" slot="content">
          <form [formGroup]="tipForm" (ngSubmit)="submitTip()" class="admin-form">
            <ion-list lines="none">
              <ion-item>
                <ion-label position="stacked">Titulo</ion-label>
                <ion-input formControlName="titulo"></ion-input>
              </ion-item>
              <ion-item>
                <ion-label position="stacked">Tipo</ion-label>
                <ion-input formControlName="tipo"></ion-input>
              </ion-item>
              <ion-item>
                <ion-label position="stacked">Contenido</ion-label>
                <ion-input formControlName="contenido"></ion-input>
              </ion-item>
            </ion-list>
            <div class="form-actions">
              <ion-button type="submit">{{ tipForm.value.id ? 'Actualizar' : 'Crear' }}</ion-button>
              <ion-button fill="clear" type="button" (click)="resetTipForm()">Limpiar</ion-button>
            </div>
          </form>

          <ion-list class="admin-list">
            <ion-item *ngFor="let tip of tips()">
              <ion-label>
                <h3>{{ tip.titulo }}</h3>
                <p>{{ tip.tipo }}</p>
              </ion-label>
              <ion-button fill="clear" size="small" (click)="editTip(tip)">Editar</ion-button>
              <ion-button fill="clear" size="small" color="danger" (click)="deleteTip(tip.id)">Eliminar</ion-button>
            </ion-item>
          </ion-list>
        </div>
      </ion-accordion>

      <ion-accordion value="usuarios">
        <ion-item slot="header" color="light" class="accordion-header">
          <ion-icon slot="start" name="people-outline"></ion-icon>
          <ion-label>Gestionar usuarios</ion-label>
        </ion-item>
        <div class="accordion-content" slot="content">
          <ion-list class="admin-list">
            <ion-item *ngFor="let user of users()">
              <ion-label>
                <h3>{{ user.name || user.username }}</h3>
                <p>{{ user.email }}</p>
              </ion-label>
              <ion-segment [value]="user.role" (ionChange)="onRoleChange(user, $event)">
                <ion-segment-button value="usuario">Usuario</ion-segment-button>
                <ion-segment-button value="admin">Admin</ion-segment-button>
              </ion-segment>
              <ion-select
                interface="popover"
                placeholder="Nivel"
                [value]="user.level"
                (ionChange)="onLevelChange(user, $event)"
              >
                <ion-select-option value="Novato">Novato</ion-select-option>
                <ion-select-option value="Experto">Experto</ion-select-option>
                <ion-select-option value="Maestro">Maestro</ion-select-option>
              </ion-select>
              <ion-button
                fill="clear"
                size="small"
                [color]="user.active ? 'success' : 'medium'"
                (click)="toggleUserStatus(user)"
              >
                {{ user.active ? 'Activo' : 'Inactivo' }}
              </ion-button>
            </ion-item>
          </ion-list>
        </div>
      </ion-accordion>
    </ion-accordion-group>
  </section>
</ion-content>
